<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini GTA RP 3D</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<style>
body { margin:0; overflow:hidden; background:black; font-family:Arial; }
#ui {
position:absolute;
top:10px;
left:10px;
color:white;
background:rgba(0,0,0,0.6);
padding:10px;
border-radius:10px;
}
button { margin:2px; }

#joystick {
position:absolute;
bottom:40px;
left:40px;
width:120px;
height:120px;
background:rgba(255,255,255,0.15);
border-radius:50%;
}
#stick {
width:60px;
height:60px;
background:white;
border-radius:50%;
position:absolute;
left:30px;
top:30px;
}

#shootBtn{
position:absolute;
bottom:80px;
right:60px;
width:80px;
height:80px;
background:red;
border-radius:50%;
color:white;
font-size:18px;
}
</style>
</head>
<body>

<div id="ui">
<div>HP: <span id="hp">100</span></div>
<div>Деньги: $<span id="money">0</span></div>
<div>Роль: <span id="role">Игрок</span></div>
<div>Фракция: <span id="faction">Нет</span></div>
<button onclick="setFaction('Полиция')">Полиция</button>
<button onclick="setFaction('Медики')">Медики</button>
<button onclick="setFaction('Правительство')">Правительство</button>
<button onclick="setFaction('Прокуратура')">Прокуратура</button>
</div>

<div id="joystick"><div id="stick"></div></div>
<button id="shootBtn">FIRE</button>

<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(20,40,20);
scene.add(light);

const ambient = new THREE.AmbientLight(0xffffff,0.4);
scene.add(ambient);

// Земля
const ground = new THREE.Mesh(
new THREE.PlaneGeometry(500,500),
new THREE.MeshStandardMaterial({color:0x3cb371})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// Игрок
const player = new THREE.Mesh(
new THREE.BoxGeometry(1,2,1),
new THREE.MeshStandardMaterial({color:0x00ffff})
);
player.position.y = 1;
scene.add(player);

// Машина
const car = new THREE.Mesh(
new THREE.BoxGeometry(4,1,2),
new THREE.MeshStandardMaterial({color:0xff0000})
);
car.position.set(10,0.5,10);
scene.add(car);

// Город (здания)
for(let i=0;i<50;i++){
let building = new THREE.Mesh(
new THREE.BoxGeometry(3,Math.random()*10+3,3),
new THREE.MeshStandardMaterial({color:0x888888})
);
building.position.set(
(Math.random()-0.5)*200,
building.geometry.parameters.height/2,
(Math.random()-0.5)*200
);
scene.add(building);
}

camera.position.set(0,5,10);

let moveX=0, moveZ=0;
let hp=100;
let money=0;
let inCar=false;

function setFaction(name){
document.getElementById("faction").innerText=name;
}

function updateUI(){
document.getElementById("hp").innerText=hp;
document.getElementById("money").innerText=money;
}

const joystick=document.getElementById("joystick");
const stick=document.getElementById("stick");

joystick.addEventListener("touchmove", function(e){
const touch=e.touches[0];
const rect=joystick.getBoundingClientRect();
let x=touch.clientX-rect.left-60;
let y=touch.clientY-rect.top-60;
x=Math.max(-40,Math.min(40,x));
y=Math.max(-40,Math.min(40,y));
stick.style.left=30+x+"px";
stick.style.top=30+y+"px";
moveX=x/40;
moveZ=y/40;
});

joystick.addEventListener("touchend", function(){
stick.style.left="30px";
stick.style.top="30px";
moveX=0; moveZ=0;
});

document.getElementById("shootBtn").addEventListener("click",()=>{
let bullet=new THREE.Mesh(
new THREE.SphereGeometry(0.2,8,8),
new THREE.MeshStandardMaterial({color:0xffff00})
);
bullet.position.copy(player.position);
scene.add(bullet);

let direction=new THREE.Vector3(0,0,-1);
direction.applyQuaternion(player.quaternion);

let speed=0.5;

function shoot(){
bullet.position.add(direction.clone().multiplyScalar(speed));
if(bullet.position.length()>200) scene.remove(bullet);
requestAnimationFrame(shoot);
}
shoot();

money+=10;
updateUI();
});

document.addEventListener("dblclick",()=>{
if(player.position.distanceTo(car.position)<5){
inCar=!inCar;
}
});

function animate(){
requestAnimationFrame(animate);

if(inCar){
car.position.x+=moveX*0.3;
car.position.z+=moveZ*0.3;
player.position.copy(car.position);
player.position.y=1;
}else{
player.position.x+=moveX*0.2;
player.position.z+=moveZ*0.2;
}

camera.position.x=player.position.x;
camera.position.z=player.position.z+10;
camera.lookAt(player.position);

renderer.render(scene,camera);
}
animate();
</script>

</body>
</html>
