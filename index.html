<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini GTA Mobile</title>
<style>
body { margin:0; overflow:hidden; touch-action:none; }
#enterBtn {
position:absolute;
right:20px;
bottom:40px;
width:70px;
height:70px;
border-radius:50%;
background:red;
color:white;
font-size:16px;
border:none;
}
#joystickBase {
position:absolute;
left:30px;
bottom:40px;
width:120px;
height:120px;
background:rgba(255,255,255,0.2);
border-radius:50%;
}
#joystickStick {
position:absolute;
left:60px;
bottom:70px;
width:60px;
height:60px;
background:rgba(255,255,255,0.6);
border-radius:50%;
transform:translate(-50%,-50%);
}
</style>
</head>
<body>

<button id="enterBtn">ðŸš—</button>
<div id="joystickBase"></div>
<div id="joystickStick"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<script>
let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

let light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(10,20,10);
scene.add(light);

let ground = new THREE.Mesh(
new THREE.PlaneGeometry(200,200),
new THREE.MeshStandardMaterial({color:0x444444})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

// Ð³Ð¾Ñ€Ð¾Ð´
for(let i=-50;i<=50;i+=10){
for(let j=-50;j<=50;j+=10){
if(Math.random()>0.7){
let h = Math.random()*10+5;
let building = new THREE.Mesh(
new THREE.BoxGeometry(6,h,6),
new THREE.MeshStandardMaterial({color:0x888888})
);
building.position.set(i,h/2,j);
scene.add(building);
}
}
}

// Ð¸Ð³Ñ€Ð¾Ðº
let player = new THREE.Mesh(
new THREE.BoxGeometry(1,2,1),
new THREE.MeshStandardMaterial({color:0x0000ff})
);
player.position.y=1;
scene.add(player);

// Ð¼Ð°ÑˆÐ¸Ð½Ð°
let car = new THREE.Mesh(
new THREE.BoxGeometry(3,1,2),
new THREE.MeshStandardMaterial({color:0xff0000})
);
car.position.set(5,0.5,5);
scene.add(car);

let inCar = false;
let carAngle = 0;
let moveX = 0;
let moveY = 0;

// Ð´Ð¶Ð¾Ð¹ÑÑ‚Ð¸Ðº
let base = document.getElementById("joystickBase");
let stick = document.getElementById("joystickStick");

base.addEventListener("touchmove", e=>{
let touch = e.touches[0];
let rect = base.getBoundingClientRect();
let x = touch.clientX - rect.left - 60;
let y = touch.clientY - rect.top - 60;

let dist = Math.sqrt(x*x + y*y);
let max = 50;
if(dist > max){
x = x/dist * max;
y = y/dist * max;
}

stick.style.left = (rect.left + 60 + x) + "px";
stick.style.top = (rect.top + 60 + y) + "px";

moveX = x/50;
moveY = y/50;
});

base.addEventListener("touchend", ()=>{
moveX = 0;
moveY = 0;
stick.style.left = "60px";
stick.style.top = "70px";
});

document.getElementById("enterBtn").onclick = ()=>{
if(!inCar){
let dx = player.position.x - car.position.x;
let dz = player.position.z - car.position.z;
if(Math.sqrt(dx*dx+dz*dz) < 4){
inCar = true;
}
}else{
inCar = false;
}
};

function animate(){
requestAnimationFrame(animate);

let speed = 0.2;

if(!inCar){

player.position.x += moveX * speed * 2;
player.position.z += moveY * speed * 2;

camera.position.set(
player.position.x + 8,
player.position.y + 8,
player.position.z + 8
);

}else{

carAngle -= moveX * 0.05;

car.position.x -= Math.sin(carAngle) * moveY * speed * 4;
car.position.z -= Math.cos(carAngle) * moveY * speed * 4;

car.rotation.y = carAngle;
player.position.copy(car.position);

camera.position.set(
car.position.x + Math.sin(carAngle)*10,
car.position.y + 8,
car.position.z + Math.cos(carAngle)*10
);
}

camera.lookAt(player.position);
renderer.render(scene,camera);
}

animate();

window.addEventListener("resize",()=>{
camera.aspect = window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth,window.innerHeight);
});
</script>
</body>
</html>
