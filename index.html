<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Mini GTA RP</title>
<style>
body { margin: 0; overflow: hidden; }
#info {
position: absolute;
top: 10px;
left: 10px;
color: white;
font-family: Arial;
background: rgba(0,0,0,0.5);
padding: 10px;
}
</style>
</head>
<body>

<div id="info">
WASD - движение<br>
E - сесть / выйти из машины
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<script>

let scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

let camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

let light = new THREE.DirectionalLight(0xffffff, 1);
light.position.set(5,10,7);
scene.add(light);

let ground = new THREE.Mesh(
new THREE.PlaneGeometry(200,200),
new THREE.MeshStandardMaterial({color:0x228B22})
);
ground.rotation.x = -Math.PI/2;
scene.add(ground);

let player = new THREE.Mesh(
new THREE.BoxGeometry(1,2,1),
new THREE.MeshStandardMaterial({color:0x0000ff})
);
player.position.y = 1;
scene.add(player);

let car = new THREE.Mesh(
new THREE.BoxGeometry(3,1,2),
new THREE.MeshStandardMaterial({color:0xff0000})
);
car.position.set(5,0.5,0);
scene.add(car);

let keys = {};
let inCar = false;

document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

function distance(a,b){
return Math.sqrt(
Math.pow(a.position.x - b.position.x,2) +
Math.pow(a.position.z - b.position.z,2)
);
}

function animate(){
requestAnimationFrame(animate);

let speed = 0.1;

if(!inCar){

if(keys["w"]) player.position.z -= speed;
if(keys["s"]) player.position.z += speed;
if(keys["a"]) player.position.x -= speed;
if(keys["d"]) player.position.x += speed;

if(keys["e"] && distance(player,car) < 3){
inCar = true;
}

camera.position.set(
player.position.x,
player.position.y + 5,
player.position.z + 10
);

}else{

if(keys["w"]) car.position.z -= speed*2;
if(keys["s"]) car.position.z += speed*2;
if(keys["a"]) car.position.x -= speed*2;
if(keys["d"]) car.position.x += speed*2;

player.position.copy(car.position);

if(keys["e"]){
inCar = false;
}

camera.position.set(
car.position.x,
car.position.y + 5,
car.position.z + 10
);

}

camera.lookAt(player.position);

renderer.render(scene,camera);
}

animate();

window.addEventListener("resize", () => {
camera.aspect = window.innerWidth/window.innerHeight;
camera.updateProjectionMatrix();
renderer.setSize(window.innerWidth, window.innerHeight);
});

</script>
</body>
</html>
});;
